<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Alimentos ‚Äî TechSide</title>
  <link rel="stylesheet" href="../css/universalCss.css">
  <link rel="stylesheet" href="../css/pInicio.css" type="text/css">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="initPag.html">üê∂ TechSide Vet</a>
      <nav class="main-nav" aria-label="Navegaci√≥n principal">
        <a href="prodCatalog.html">Tienda</a>        
        <a href="horario.html">Disponibilidad</a>
        <a href="listas.html">Mis mascotas</a>
      </nav>
      <div class="header-actions">
        <a href="cart.html" class="btn-ghost" style="position:relative;display:inline-flex;align-items:center;gap:8px">
          üõí <span id="cart-count" style="background:#ef4444;color:#fff;padding:2px 6px;border-radius:999px;font-weight:700">0</span>
        </a>
        <button class="btn-primary" onclick="openLogin()">Entrar</button>
      </div>
    </div>
  </header>
  
  <main class="container" style="padding:20px">
    <h1>Alimentos</h1>
     <p class="muted">Pienso y alimentos balanceados.</p>
     <div id="product-list" style="display:flex;gap:12px;flex-wrap:wrap">
     </div>
  </main>
  <footer class="site-footer">
    <div class="container footer-inner">
      <p>¬© <span id="year"></span> TechSide</p>
      <small class="muted">T√©rminos y condiciones ¬∑ Pol√≠tica de privacidad</small>
    </div>
  </footer>

  <div id="login-modal" class="login-modal" onclick="closeOnOutsideClick(event)">
    <div class="login-content">
      <span class="close" onclick="document.getElementById('login-modal').style.display='none'">&times;</span>
      <form id="login-form" class="login-form">
        <h2>Ingresar</h2>
        <input type="email" id="login-email" placeholder="Usuario" required>
        <input type="password" id="login-password" placeholder="Contrase√±a" required>
        <button type="submit" class="btn-primary">Entrar</button>
      </form>
    </div>
  </div>

  <script> document.getElementById('year').textContent = new Date().getFullYear(); </script>
  <script>
    function openLogin() { document.getElementById('login-modal').style.display = 'flex'; }
    function closeLogin() { document.getElementById('login-modal').style.display = 'none'; }
    function closeOnOutsideClick(event) {
      const modal = document.getElementById('login-modal');
      if (modal && !modal.querySelector('.login-content').contains(event.target)) closeLogin();
    }
    
    document.getElementById('login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        fetch('/api/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.token) {
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                window.location.reload();
            } else {
                alert(data.message || 'Error al iniciar sesi√≥n');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al iniciar sesi√≥n');
        });
    });

    (function() {
        const productList = document.getElementById('product-list');
        fetch('/api/productos?categoria=Alimentos')
            .then(response => response.json())
            .then(products => {
                products.forEach(product => {
                    const article = document.createElement('article');
                    article.className = 'producto';
                    article.style = "width:180px;height:220px;padding:0;border-radius:6px;overflow:hidden";
                    article.innerHTML = `
                        <img src="${product.imagen_url || '../img/extras/doge.jpg'}" style="width:100%;height:160px;object-fit:cover;display:block"><div style="padding:8px;text-align:center"><h3 style="margin:0;font-size:14px">${product.nombre}</h3><div class="muted" style="font-size:12px">${product.descripcion}</div><div style="margin-top:6px;color:#22c55e;font-weight:700">$${product.precio.toFixed(2)}</div></div>
                    `;
                    productList.appendChild(article);
                });
            })
            .catch(error => console.error('Error fetching products:', error));
    })();
  </script>
</body>
</html>