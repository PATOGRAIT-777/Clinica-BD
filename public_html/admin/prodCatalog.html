<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tienda ‚Äî TechSide Vet</title>
  
  <link rel="stylesheet" href="../css/universalCss.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <style>
      body { padding-top: 0; }
      /* Ajuste para que el contenido no quede debajo del sidebar en desktop */
      @media (min-width: 880px) {
          .contenido-tienda { margin-left: 0px; transition: margin-left 0.3s; }
          .sidebar.active ~ .contenido-tienda { margin-left: 300px; }
      }
  </style>
</head>
<body>

  <header class="site-header">
    <div class="container header-inner">
      <div style="display:flex; align-items:center; gap:15px;">
          <button id="menu-toggle" style="background:#16a34a; border:1px solid #16a34a; font-size:24px; color:#fff; padding:6px 10px; border-radius:6px">&#9776;</button>
          <a class="brand" href="initPag.html">üê∂ TechSide Vet</a>
      </div>
      
      <nav class="main-nav">
        <a href="initPag.html">Inicio</a>
        <a class="active" href="prodCatalog.html">Tienda</a>
        <a href="listas.html">Mis Mascotas</a>
        <a href="regUser.html">Cuenta</a>
      </nav>
      <div class="header-actions">
        <a href="cart.html" class="btn-ghost" style="position:relative;display:inline-flex;align-items:center;gap:8px">
          üõí <span id="cart-count" style="background:#ef4444;color:#fff;padding:2px 6px;border-radius:999px;font-weight:700">0</span>
        </a>
        <button class="btn-primary" onclick="openLogin()">Entrar</button>
      </div>
    </div>
  </header>

  <nav class="sidebar" id="sidebar">
    <div style="padding: 20px; text-align: right;">
        <span onclick="document.getElementById('sidebar').classList.remove('active')" style="color:white; cursor:pointer; font-size: 24px;">&times;</span>
    </div>
    <ul class="sidebar-list">
        <li><a href="#">Ofertas üî•</a></li>
        <li><a href="#">Destacados ‚≠ê</a></li>
        <hr>
        <li><a href="#">üê∂ Perros</a></li>
        <li><a href="#">üê± Gatos</a></li>
        <li><a href="#">üíä Farmacia</a></li>
        <li><a href="#">üõÅ Higiene</a></li>
    </ul>
  </nav>

  <style>
    /* Override sidebar to be overlay on this page */
    #sidebar{position:fixed;left:-320px;top:0;height:100%;width:300px;z-index:40;background:var(--surface,#0f172a);transition:left .22s ease}
    #sidebar.active{left:0}
    .contenido-tienda{transition:margin-left .2s}
    /* prevent other CSS from pushing content when sidebar opens */
    .sidebar.active ~ .contenido-tienda { margin-left: 0 !important }
    .carrusel img{width:100%;height:100%;object-fit:cover}
    .carrusel{height:320px;overflow:hidden;border-radius:8px}
    .producto{border-radius:8px;padding:12px;background:var(--card,#fff);box-shadow:0 1px 4px rgba(0,0,0,0.06);margin-bottom:12px}
    .discount-badge{position:absolute;top:8px;left:8px;background:#f97316;color:#fff;padding:4px 8px;border-radius:4px;font-weight:700}

    /* Vertical category sections with horizontal scrollers */
    #shop-sections-vertical{margin-top:20px;display:flex;flex-direction:column;gap:18px}
    .section-row{background:linear-gradient(160deg,#0840c2 0%, var(--bg) 100%);padding:12px;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,0.06)}
    .section-row .row-header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:8px}
    .section-row h4{margin:0}
    .section-scroller{overflow-x:auto;display:flex;gap:12px;padding-bottom:8px;-webkit-overflow-scrolling:touch}
    .section-card{min-width:160px;width:160px;flex:0 0 auto;background:linear-gradient(180deg,#071025 0%, var(--bg) 100%);border-radius:8px;padding:8px;box-shadow:0 1px 2px rgba(0,0,0,0.04);text-align:center}
    .section-card img{width:100%;height:100px;object-fit:cover;border-radius:6px}
    .section-card h5{font-size:14px;margin:8px 0 4px}
    .section-card p{font-size:12px;color:var(--muted,#6b7280);margin:0}
    .section-card .price{color:#22c55e;font-weight:700;margin-top:6px}
    @media (min-width:1000px){
      /* keep layout comfortable on wide screens */
      .contenido-tienda{max-width:1100px}
    }
  </style>

  <main class="contenido contenido-tienda container">
      
        <section class="carrusel-container">
          <div class="carrusel">
            <div class="carrusel-item active" style="display:block;height:100%">
              <img src="../img/extras/doge.jpg" alt="Promo 1"> </div>
            <div class="carrusel-item" style="height:100%">
              <img src="../img/extras/Fairy Tail 2.png" alt="Promo 2">
            </div>
          </div>
        </section>

      <div style="text-align:center; margin: 30px 0;">
          <h1>Cat√°logo de Productos</h1>
          <p class="muted">Todo lo que tu mascota necesita, recomendado por veterinarios.</p>
      </div>

        <div class="productos">
        </div>

        <script>
            (function() {
                const token = localStorage.getItem('token');
                fetch('/api/productos', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                }).then(r => r.json()).then(products => {
                    const container = document.querySelector('.productos');
                    container.innerHTML = '';
                    products.forEach(product => {
                        const article = document.createElement('article');
                        article.className = 'producto';
                        article.dataset.category = product.categoria;
                        article.dataset.name = product.nombre;
                        article.dataset.price = product.precio;
                        article.dataset.id = product.id;
                        article.innerHTML = `
                            <div style="position:relative">
                                <img src="${product.imagen_url || '../img/extras/doge.jpg'}" alt="${product.nombre}" style="width:100%;height:160px;object-fit:cover;border-radius:6px">
                            </div>
                            <h3>${product.nombre}</h3>
                            <p class="muted">${product.descripcion}</p>
                            <h2 style="color: #22c55e; margin: 10px 0;">$${product.precio.toFixed(2)}</h2>
                            <div style="display:flex;gap:8px"> <input class="qty" type="number" min="1" value="1" style="width:80px"> <button class="btn-primary add-to-cart">A√±adir</button> <button class="btn-ghost buy-now">Comprar ahora</button></div>
                        `;
                        container.appendChild(article);
                    });
                });
            })();
        </script>


        <!-- Vertical stacked sections with horizontal scrollers (replaces right-side fixed aside) -->
        <section id="shop-sections-vertical">
          <div class="section-row">
            <div class="row-header">
              <h4>Est√©tica y ba√±o</h4>
              <a class="a-link-normal" href="estetica.html">Ver m√°s</a>
            </div>
            <div class="section-scroller">
              <div class="section-card">
                <img src="../img/extras/doge.jpg" alt="A">
                <h5>Shampoo profesional</h5>
                <p class="muted">250 ml</p>
                <div class="price">$120</div>
              </div>
              <div class="section-card">
                <img src="../img/extras/doge.jpg" alt="B">
                <h5>Corta√∫√±as</h5>
                <p class="muted">Acero inoxidable</p>
                <div class="price">$80</div>
              </div>
              <div class="section-card">
                <img src="../img/extras/doge.jpg" alt="C">
                <h5>Toalla microfibra</h5>
                <p class="muted">Secado r√°pido</p>
                <div class="price">$60</div>
              </div>
            </div>
          </div>

          <div class="section-row">
            <div class="row-header">
              <h4>Alimentos</h4>
              <a class="a-link-normal" href="alimentos.html">Ver m√°s</a>
            </div>
            <div class="section-scroller">
              <div class="section-card">
                <img src="../img/extras/doge.jpg" alt="A">
                <h5>Croquetas Premium</h5>
                <p class="muted">Adulto raza mediana</p>
                <div class="price">$850</div>
              </div>
              <div class="section-card">
                <img src="../img/extras/doge.jpg" alt="B">
                <h5>Snack dental</h5>
                <p class="muted">Paquete 30pz</p>
                <div class="price">$150</div>
              </div>
              <div class="section-card">
                <img src="../img/extras/doge.jpg" alt="C">
                <h5>Alimento h√∫medo</h5>
                <p class="muted">80 g</p>
                <div class="price">$30</div>
              </div>
            </div>
          </div>

          <div class="section-row">
            <div class="row-header">
              <h4>Accesorios</h4>
              <a class="a-link-normal" href="accesorios.html">Ver m√°s</a>
            </div>
            <div class="section-scroller">
              <div class="section-card">
                <img src="../img/extras/doge.jpg" alt="A">
                <h5>Juguete Mordedera</h5>
                <p class="muted">Alta resistencia</p>
                <div class="price">$120</div>
              </div>
              <div class="section-card">
                <img src="../img/extras/doge.jpg" alt="B">
                <h5>Correa reflectante</h5>
                <p class="muted">Largo 1.5m</p>
                <div class="price">$90</div>
              </div>
              <div class="section-card">
                <img src="../img/extras/doge.jpg" alt="C">
                <h5>Cama orthop√©dica</h5>
                <p class="muted">Mediana</p>
                <div class="price">$450</div>
              </div>
            </div>
          </div>

          <div class="section-row">
            <div class="row-header">
              <h4>Farmacia</h4>
              <a class="a-link-normal" href="farmacia.html">Ver m√°s</a>
            </div>
            <div class="section-scroller">
              <div class="section-card">
                <img src="../img/extras/doge.jpg" alt="A">
                <h5>Pipeta Antipulgas</h5>
                <p class="muted">Protecci√≥n 3 meses</p>
                <div class="price">$250</div>
              </div>
              <div class="section-card">
                <img src="../img/extras/doge.jpg" alt="B">
                <h5>Vacuna</h5>
                <p class="muted">Fiebre canina</p>
                <div class="price">$320</div>
              </div>
              <div class="section-card">
                <img src="../img/extras/doge.jpg" alt="C">
                <h5>Suplemento</h5>
                <p class="muted">Articulaciones</p>
                <div class="price">$200</div>
              </div>
            </div>
          </div>
        </section>

  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
        <p>¬© <span id="year"></span> TechSide</p>
        <small class="muted">T√©rminos y condiciones ¬∑ Pol√≠tica de privacidad</small>
    </div>
  </footer>

  <div id="login-modal" class="login-modal" onclick="closeOnOutsideClick(event)">
    <div class="login-content">
      <span class="close" onclick="document.getElementById('login-modal').style.display='none'">&times;</span>
      <form id="login-form" class="login-form">
        <h2>Ingresar</h2>
        <input type="email" id="login-email" placeholder="Usuario" required>
        <input type="password" id="login-password" placeholder="Contrase√±a" required>
        <button type="submit" class="btn-primary">Entrar</button>
      </form>
    </div>
  </div>

  <script>
    // L√≥gica del Men√∫
    const toggleBtn = document.getElementById('menu-toggle');
    const sidebar = document.getElementById('sidebar');
    
    toggleBtn.addEventListener('click', () => {
        sidebar.classList.toggle('active');
    });

    // L√≥gica del Login
    function openLogin() { document.getElementById('login-modal').style.display = 'flex'; }
    function closeLogin() { document.getElementById('login-modal').style.display = 'none'; }
    function closeOnOutsideClick(event) {
      const modal = document.getElementById('login-modal');
      if (modal && !modal.querySelector('.login-content').contains(event.target)) closeLogin();
    }
    
    document.getElementById('login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        fetch('/api/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.token) {
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                window.location.reload();
            } else {
                alert(data.message || 'Error al iniciar sesi√≥n');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al iniciar sesi√≥n');
        });
    });

    // Shopping cart (localStorage)
    function getCart(){ return JSON.parse(localStorage.getItem('cart')||'[]'); }
    function setCart(c){ localStorage.setItem('cart', JSON.stringify(c)); updateCartCount(); }
    function updateCartCount(){ const c = getCart(); const qty = c.reduce((s,i)=>s+i.qty,0); document.getElementById('cart-count').textContent = qty; }

    document.addEventListener('click', function(e){
      if(e.target && e.target.classList.contains('add-to-cart')){
        const art = e.target.closest('.producto');
        const id = art.dataset.id;
        const name = art.dataset.name || art.querySelector('h3')?.textContent || 'Producto';
        const price = parseFloat(art.dataset.price||0);
        const qtyEl = art.querySelector('.qty');
        const qty = Math.max(1, parseInt(qtyEl?.value||1,10));
        const cart = getCart();
        const existing = cart.find(i=>i.id===id);
        if(existing) existing.qty += qty; else cart.push({id,name,price,qty});
        setCart(cart);
        alert(qty + ' √ó ' + name + ' a√±adidos al carrito');
      }
      if(e.target && e.target.classList.contains('buy-now')){
        const art = e.target.closest('.producto'); const name = art.dataset.name || art.querySelector('h3')?.textContent || 'Producto';
        const price = parseFloat(art.dataset.price||0); const qty = Math.max(1, parseInt(art.querySelector('.qty')?.value||1,10));
        localStorage.setItem('checkout_now', JSON.stringify([{id:art.dataset.id,name,price,qty}]));
        location.href = 'cart.html';
      }
    });

    // initialize cart count
    updateCartCount();

    // Carrusel Simple
    let index = 0;
    const items = document.querySelectorAll('.carrusel-item');
    if(items.length > 0){
        function showSlide() {
            items.forEach(el => el.style.display = 'none');
            items[index].style.display = 'block';
            index = (index + 1) % items.length;
            setTimeout(showSlide, 4000);
        }
        showSlide();
    }
  </script>
  <script> document.getElementById('year')?.textContent = new Date().getFullYear(); </script>
</body>
</html>
